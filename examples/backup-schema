create table locations
(
    id             serial
        constraint pk_locations
            primary key,
    name           varchar not null,
    iso_code       varchar,
    sap_code       integer,
    full_location  varchar,
    zip_code       varchar,
    short_location varchar,
    parent_id      integer
        constraint parent_id
            references locations,
    type           varchar,
    migrated       boolean default false,
    status         varchar
);

alter table locations
    owner to postgres;

create table organizations
(
    id                serial
        primary key,
    company_logo      varchar,
    address           varchar,
    phone             varchar,
    alternative_phone varchar,
    contact_time      varchar,
    email             varchar               not null
        constraint "UQ_4ad920935f4d4eb73fc58b40f72"
            unique,
    location_id       varchar,
    full_location     varchar,
    geo_lat           varchar,
    geo_long          varchar,
    professional_type varchar,
    deleted           boolean default false not null,
    company_name      varchar(255)          not null,
    admin_user        integer,
    social_reason     varchar,
    fiscal_condition  varchar,
    cuit              varchar
);

alter table organizations
    owner to postgres;

create table branches
(
    id                serial
        primary key,
    branch_logo       varchar,
    branch_name       varchar not null,
    address           varchar,
    phone             varchar,
    alternative_phone varchar,
    contact_time      varchar,
    email             varchar not null
        unique,
    location_id       varchar,
    full_location     varchar,
    geo_lat           varchar,
    geo_long          varchar,
    organization_id   integer
        constraint "FK_9ecf73d5ca57108dc33c87f7d88"
            references organizations
            on delete cascade,
    deleted           boolean default false
);

alter table branches
    owner to postgres;

create table permissions
(
    id          serial
        primary key,
    name        varchar(100) not null
        constraint "UQ_48ce552495d14eae9b187bb6716"
            unique,
    description text
);

alter table permissions
    owner to postgres;

create table users
(
    id              serial
        primary key,
    role_id         integer,
    organization_id integer
        constraint "FK_21a659804ed7bf61eb91688dea7"
            references organizations
            on delete cascade,
    permission_id   integer
        constraint "FK_4daed8ecfcce827ad3a6ba2587c"
            references permissions,
    phone           varchar(50),
    bio             text,
    avatar          varchar(255),
    is_verified     boolean   default false not null,
    created_at      timestamp default now() not null,
    updated_at      timestamp default now() not null,
    name            varchar(255)            not null,
    email           varchar(255)            not null,
    password        varchar(255)            not null
);

alter table users
    owner to postgres;

alter table organizations
    add constraint "FK_84687878ce7a62025e1774b31ad"
        foreign key (admin_user) references users
            on delete set null;

create unique index "IDX_97672ac88f789774dd47f7c8be"
    on users (email);

create table users_branches
(
    user_id   integer not null
        constraint "FK_a2298d713539687b12f2c169ba4"
            references users
            on update cascade on delete cascade,
    branch_id integer not null
        constraint "FK_6e191d2fe767c69e4d76e46a30e"
            references branches,
    constraint "PK_9da378646b233e4b5001d24cba7"
        primary key (user_id, branch_id)
);

alter table users_branches
    owner to postgres;

create index "IDX_a2298d713539687b12f2c169ba"
    on users_branches (user_id);

create index "IDX_6e191d2fe767c69e4d76e46a30"
    on users_branches (branch_id);

create table properties
(
    id                       integer   default nextval('properties_id_seq'::regclass) not null
        primary key,
    reference_code           varchar(100)                                             not null
        unique,
    publication_title        varchar(500)                                             not null,
    publication_title_en     varchar(500),
    description              text,
    internal_comments        text,
    street                   varchar(255),
    number                   varchar(50),
    floor                    varchar(20),
    apartment                varchar(20),
    location_id              integer,
    geo_lat                  numeric(10, 8),
    geo_long                 numeric(11, 8),
    property_type            integer                                                  not null,
    status                   integer                                                  not null,
    suite_amount             integer,
    room_amount              integer,
    bathroom_amount          integer,
    toilet_amount            integer,
    parking_lot_amount       integer,
    surface                  numeric(10, 2),
    roofed_surface           numeric(10, 2),
    unroofed_surface         numeric(10, 2),
    semiroofed_surface       numeric(10, 2),
    total_surface            numeric(10, 2),
    surface_measurement      varchar(10),
    age                      integer,
    property_condition       varchar(100),
    situation                varchar(100),
    dispositions             varchar(100),
    orientation              varchar(50),
    floors_amount            integer,
    zonification             varchar(100),
    expenses                 integer,
    commission               varchar(50),
    network_share            varchar(50),
    operation_type           varchar(50)                                              not null,
    price                    numeric(15, 2)                                           not null,
    currency                 varchar(3)                                               not null,
    period                   varchar(50),
    producer_user            varchar(255),
    branch                   varchar(255),
    key_contact              varchar(255),
    key_agent_user           varchar(255),
    key_location             varchar(100),
    key_reference_code       varchar(255),
    maintenance_user         varchar(255),
    development              varchar(255),
    network_information      text,
    transaction_requirements text,
    created_at               timestamp default now()                                  not null,
    updated_at               timestamp default now()                                  not null,
    deleted_at               timestamp,
    deleted                  boolean   default false                                  not null
);

alter table properties
    owner to postgres;

create index idx_properties_status
    on properties (status);

create index idx_properties_property_type
    on properties (property_type);

create index idx_properties_location_id
    on properties (location_id);

create index idx_properties_reference_code
    on properties (reference_code);

create index idx_properties_branch
    on properties (branch);

create table property_operations
(
    id             bigint         not null
        primary key,
    property_id    bigint         not null,
    currency       varchar(3)     not null,
    price          numeric(15, 2) not null,
    period         varchar(50),
    "propertyId"   bigint
        constraint "FK_35ede2af03b824b35423f66445b"
            references properties
            on delete cascade,
    operation_type varchar(50)    not null
);

alter table property_operations
    owner to postgres;

create index idx_property_operations_property_id
    on property_operations (property_id);

create table property_images
(
    id             bigint                not null
        primary key,
    property_id    bigint                not null,
    url            varchar(500)          not null,
    is_blueprint   boolean default false not null,
    description    text,
    order_position integer,
    "propertyId"   bigint
        constraint "FK_7a07b6b7f9418bf1d5160106694"
            references properties
            on delete cascade
);

alter table property_images
    owner to postgres;

create index idx_property_images_property_id
    on property_images (property_id);

create table property_tags
(
    id           bigint       not null
        primary key,
    tag_id       integer      not null,
    property_id  bigint       not null,
    tag_name     varchar(255) not null,
    tag_type     integer      not null,
    "propertyId" bigint
        constraint "FK_dd00b8c11d8f56d9ac0a6f2d276"
            references properties
            on delete cascade
);

alter table property_tags
    owner to postgres;

create index idx_property_tags_property_id
    on property_tags (property_id);

create index idx_property_tags_tag_id
    on property_tags (tag_id);

create table property_attributes
(
    id           bigint       not null
        primary key,
    property_id  bigint       not null,
    code         varchar(100) not null,
    value        varchar(255) not null,
    "propertyId" bigint
        constraint "FK_043c5d830803966b4eea0ee21cf"
            references properties
            on delete cascade
);

alter table property_attributes
    owner to postgres;

create index idx_property_attributes_property_id
    on property_attributes (property_id);

create table tags
(
    id          integer      not null
        primary key,
    name        varchar(255) not null
        unique,
    slug        varchar(255),
    type        integer      not null,
    description text,
    is_active   boolean   default true,
    created_at  timestamp default CURRENT_TIMESTAMP,
    updated_at  timestamp default CURRENT_TIMESTAMP
);

alter table tags
    owner to postgres;

create index idx_tags_type
    on tags (type);

create index idx_tags_is_active
    on tags (is_active);

create index idx_tags_slug
    on tags (slug);

create table partners
(
    id          serial
        primary key,
    name        varchar(100) not null,
    description text,
    app_key     varchar(255) not null
        constraint uk_partners_app_key
            unique,
    app_secret  varchar(255) not null,
    status      smallint                 default 0,
    deleted     boolean                  default false,
    created_at  timestamp with time zone default CURRENT_TIMESTAMP,
    updated_at  timestamp with time zone default CURRENT_TIMESTAMP
);

alter table partners
    owner to postgres;

create index idx_partners_app_key
    on partners (app_key);

create index idx_partners_status
    on partners (status);

create index idx_partners_deleted
    on partners (deleted);

create index idx_partners_created_at
    on partners (created_at);

